@model Wuzlstats.ViewModels.Leagues.EditViewModel

<h1 class="text-2xl font-bold mb-6">League Settings: @Model.LeagueName</h1>

@if (!ViewContext.ModelState.IsValid)
{
    <div class="flex items-center p-4 mb-4 text-red-800 rounded-lg bg-red-50 border border-red-300" role="alert">
        <div class="ml-3 text-sm font-medium">
            @Html.ValidationSummary()
        </div>
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="flex items-center p-4 mb-4 text-green-800 rounded-lg bg-green-50 border border-green-300" role="alert">
        <div class="ml-3 text-sm font-medium">
            @TempData["SuccessMessage"]
        </div>
    </div>
}

<form method="POST" class="space-y-8">
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.LeagueId)
    @Html.HiddenFor(m => m.LeagueName)

    <!-- Password Section (if protected) -->
    @if (Model.HasPassword)
    {
        <div class="bg-yellow-50 border border-yellow-300 rounded-lg p-6">
            <h2 class="text-lg font-semibold mb-4">Password Required</h2>
            <div>
                <label for="CurrentPassword" class="block mb-2 text-sm font-medium text-gray-900">
                    Current Password
                </label>
                <input type="password" id="CurrentPassword" name="CurrentPassword" required
                       class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                <span asp-validation-for="CurrentPassword" class="text-red-600 text-sm"></span>
            </div>
        </div>
    }

    <!-- Team Colors Section -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Team Colors</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="TeamBlueColor" class="block mb-2 text-sm font-medium text-gray-900">
                    Blue Team Color
                </label>
                <div class="flex items-center gap-3">
                    <input type="color" id="TeamBlueColorPicker" asp-for="TeamBlueColor"
                           class="w-16 h-10 border border-gray-300 rounded cursor-pointer">
                    <input type="text" asp-for="TeamBlueColor" placeholder="#ddeeff"
                           class="flex-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                </div>
                <span asp-validation-for="TeamBlueColor" class="text-red-600 text-sm"></span>
            </div>

            <div>
                <label for="TeamRedColor" class="block mb-2 text-sm font-medium text-gray-900">
                    Red Team Color
                </label>
                <div class="flex items-center gap-3">
                    <input type="color" id="TeamRedColorPicker" asp-for="TeamRedColor"
                           class="w-16 h-10 border border-gray-300 rounded cursor-pointer">
                    <input type="text" asp-for="TeamRedColor" placeholder="#ffddee"
                           class="flex-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                </div>
                <span asp-validation-for="TeamRedColor" class="text-red-600 text-sm"></span>
            </div>
        </div>
        <p class="text-sm text-gray-600 mt-2">
            These colors will be used for team indicators, score entry fields, and badges throughout the league.
        </p>
    </div>

    <!-- Statistics Configuration Section -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Statistics Configuration</h2>
        <div>
            <label for="DaysForStatistics" class="block mb-2 text-sm font-medium text-gray-900">
                Days for Recent Statistics
            </label>
            <input type="number" asp-for="DaysForStatistics" min="1" max="1000" placeholder="90"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
            <span asp-validation-for="DaysForStatistics" class="text-red-600 text-sm"></span>
            <p class="text-sm text-gray-600 mt-2">
                Leave empty to use global default (90 days). Only games within this period will count for "recent" statistics.
            </p>
        </div>
    </div>

    <!-- Game Rules Section -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Game Rules</h2>
        <div>
            <label for="MaxScore" class="block mb-2 text-sm font-medium text-gray-900">
                Maximum Score to Win
            </label>
            <input type="number" asp-for="MaxScore" min="1" max="20"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
            <span asp-validation-for="MaxScore" class="text-red-600 text-sm"></span>
        </div>
    </div>

    <!-- Display Preferences Section -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Display Preferences</h2>
        <div class="space-y-4">
            <div>
                <label for="Description" class="block mb-2 text-sm font-medium text-gray-900">
                    League Description
                </label>
                <textarea asp-for="Description" rows="3" placeholder="A brief description of this league..."
                          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"></textarea>
                <span asp-validation-for="Description" class="text-red-600 text-sm"></span>
            </div>

            <div>
                <label for="BannerImageUrl" class="block mb-2 text-sm font-medium text-gray-900">
                    Banner Image URL
                </label>
                <input type="url" asp-for="BannerImageUrl" placeholder="https://example.com/banner.jpg"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                <span asp-validation-for="BannerImageUrl" class="text-red-600 text-sm"></span>
            </div>
        </div>
    </div>

    <!-- Statistical Preferences Section -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Statistical Preferences</h2>
        <div class="space-y-4">
            <div class="flex items-center">
                <input type="checkbox" asp-for="ShowPlayerRankings" id="ShowPlayerRankings"
                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                <label for="ShowPlayerRankings" class="ml-2 text-sm font-medium text-gray-900">
                    Show Player Rankings
                </label>
            </div>

            <div class="flex items-center">
                <input type="checkbox" asp-for="ShowTeamRankings" id="ShowTeamRankings"
                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                <label for="ShowTeamRankings" class="ml-2 text-sm font-medium text-gray-900">
                    Show Team Rankings
                </label>
            </div>

            <div>
                <label for="MinimumGamesForRanking" class="block mb-2 text-sm font-medium text-gray-900">
                    Minimum Games for Ranking
                </label>
                <input type="number" asp-for="MinimumGamesForRanking" min="0" max="100"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                <span asp-validation-for="MinimumGamesForRanking" class="text-red-600 text-sm"></span>
                <p class="text-sm text-gray-600 mt-2">
                    Players/teams must have played at least this many games to appear in rankings.
                </p>
            </div>
        </div>
    </div>

    <!-- Password Management Section -->
    <div class="bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4">Password Protection</h2>
        <p class="text-sm text-gray-600 mb-4">
            @if (Model.HasPassword)
            {
                <span>This league is currently password protected. Leave fields empty to keep current password.</span>
            }
            else
            {
                <span>Set a password to restrict who can edit league settings.</span>
            }
        </p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="NewPassword" class="block mb-2 text-sm font-medium text-gray-900">
                    New Password
                </label>
                <input type="password" asp-for="NewPassword" autocomplete="new-password"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                <span asp-validation-for="NewPassword" class="text-red-600 text-sm"></span>
            </div>

            <div>
                <label for="ConfirmPassword" class="block mb-2 text-sm font-medium text-gray-900">
                    Confirm Password
                </label>
                <input type="password" asp-for="ConfirmPassword" autocomplete="new-password"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                <span asp-validation-for="ConfirmPassword" class="text-red-600 text-sm"></span>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-4">
        <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-8 py-3 transition-colors">
            Save Settings
        </button>
        <a asp-controller="Home" asp-action="Index" asp-route-league="@Model.LeagueName"
           class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-8 py-3 transition-colors inline-block">
            Cancel
        </a>
    </div>
</form>

@section scripts {
    <script>
        // Sync color picker with text input
        document.getElementById('TeamBlueColorPicker').addEventListener('input', function(e) {
            document.getElementById('TeamBlueColor').value = e.target.value;
        });
        document.getElementById('TeamRedColorPicker').addEventListener('input', function(e) {
            document.getElementById('TeamRedColor').value = e.target.value;
        });

        // Sync text input with color picker
        document.getElementById('TeamBlueColor').addEventListener('input', function(e) {
            if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
                document.getElementById('TeamBlueColorPicker').value = e.target.value;
            }
        });
        document.getElementById('TeamRedColor').addEventListener('input', function(e) {
            if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
                document.getElementById('TeamRedColorPicker').value = e.target.value;
            }
        });
    </script>
}
